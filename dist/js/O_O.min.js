!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("O_O",[],e):"object"==typeof exports?exports.O_O=e():t.O_O=e()}(window,function(){return(i={},r.m=n=[function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r={Station:i.Station,TrainType:i.TrainType,Diagram:i.Diagram,Time:i.Time,Streak:i.Streak,StHandling:i.StHandling,DataSet:i.DataSet,EndpointWork:i.EndpointWork};e.default=r},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function e(t){r(this,e),this._r=0,this._g=0,void(this._b=0)!==t&&this.setFromHEX(t)}return o(e,[{key:"setFromHEX",value:function(t){var e=[t.match(/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/),t.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/)];null!==e[0]?(this._r=parseInt(e[0][1]+e[0][1],16),this._g=parseInt(e[0][2]+e[0][2],16),this._b=parseInt(e[0][3]+e[0][3],16)):null!==e[1]?(this._r=parseInt(e[1][1],16),this._g=parseInt(e[1][2],16),this._b=parseInt(e[1][3],16)):console.log("ERROR")}},{key:"setFromABGR",value:function(t){var e=t.match(/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/);this._r=parseInt(e[4],16),this._g=parseInt(e[3],16),this._b=parseInt(e[2],16)}},{key:"RGB",value:function(){return"rgb("+this._r+", "+this._g+", "+this._b+")"}},{key:"HEX",value:function(t){return(!(0<arguments.length&&void 0!==t)||t?"#":"")+this._r.toString(16)+this._g.toString(16)+this._b.toString(16)}},{key:"BGR",value:function(t){return(!(0<arguments.length&&void 0!==t)||t?"#":"")+this._b.toString(16)+this._g.toString(16)+this._r.toString(16)+"00"}}]),e}();e.Color=h;var v=function(){function e(t){if(r(this,e),this.isNull=!0,this._h=0,this._m=0,this._s=0,null==t)return this.isNull=!0,this._h=0,this._m=0,void(this._s=0);this.setTime(t)}return o(e,[{key:"setTime",value:function(t){if(null===t.match(/^[0-9]{3,6}$/))return this._h=0,this._m=0,void(this._s=0);var e=parseInt(t);3<=t.length&&t.length<=4?(this._h=Math.floor(e/100),this._m=e%100,this._s=0):5<=t.length&&t.length<=6&&(this._h=Math.floor(e/1e4),this._m=Math.floor(e%1e4/100),this._s=e%100),this.normalize()}},{key:"__slice",value:function(t){return("00"+t).slice(-2)}},{key:"normalize",value:function(){this._m+=Math.floor(this._s/60),this._h+=Math.floor(this._m/60),this._s%=60,this._m%=60,this._h%=24}},{key:"str",value:function(t,e){var n=!(1<arguments.length&&void 0!==e)||e;return!(0<arguments.length&&void 0!==t)||t?this.h+":"+this.m+(n?":"+this.s:""):this.h+this.m+(n?this.s:"")}},{key:"h",get:function(){if(!this.isNull)return this.__slice(this._h)},set:function(t){void 0!==i(t)&&(this._h=0);var e=parseInt(t);this._h=NaN===e?0:e}},{key:"m",get:function(){if(!this.isNull)return this.__slice(this._h)},set:function(t){var e=parseInt(t);this._m=NaN===e?0:e}},{key:"s",get:function(){if(!this.isNull)return this.__slice(this._h)},set:function(t){var e=parseInt(t);this._s=NaN===e?0:e}}]),e}();e.Time=v;var u=function(){function S(){r(this,S),this._fileType="",this._fileTypeAppComment="",this._name="",this._color=new h,this._stations=new Array,this._trainTypes=new Array,this._diagrams=new Array,this.fileStruct={Rosen:[[]],Eki:[[]],Ressyasyubetsu:[[]],Dia:[{}],DispProp:[[]]}}return o(S,[{key:"fromOud",value:function(d){var g=this;return new Promise(function(t,e){for(var n="",i=0;i<d.length;i++){var r=d[i],s=r.match(/^(.+)\.$/),o=r.match(/^\.$/);if(null!==s)if("Dia"==(n=s[1])){for(var u="root",a={start:i,end:-1,Kudari:[[]],Nobori:[[]]},h="",l=i+=1;l<d.length;l++){var f=d[l],c=f.match(/^(.+)\.$/),_=f.match(/^\.$/);if(null!==c)"Kudari"==(h=c[1])?u="Kudari":"Nobori"==h?u="Nobori":"Ressya"==h&&(a[u][a[u].length]={start:l});else if(null!==_)if("Ressya"==h)a[u][a[u].length-1].end=l,h=u;else if("Kudari"==u||"Nobori"==u)a[u][a[u].length-1].end=l,a[u].shift(),u="root";else if("root"==u){i=l;break}}a.end=i,g.fileStruct.Dia.push(a)}else g.fileStruct[n][g.fileStruct[n].length]={start:i};else null!==o&&("Dia"==n?g.fileStruct.Rosen[g.fileStruct.Rosen.length-1].end=i:g.fileStruct[n][g.fileStruct[n].length-1].end=i)}g.fileStruct.Rosen.shift(),g.fileStruct.Eki.shift(),g.fileStruct.Ressyasyubetsu.shift(),g.fileStruct.Dia.shift(),g.fileStruct.DispProp.shift(),g.stations=new Array(g.fileStruct.Eki.length),g.trainTypes=new Array(g.fileStruct.Ressyasyubetsu.length),g.diagrams=new Array(g.fileStruct.Dia.length),t()}).then(function(){Promise.all([new Promise(function(t,e){var n=S.split(d[0]);if("FileType"==n[0]){g.fileType=n[1];var i=S.split(d[g.fileStruct.DispProp[g.fileStruct.DispProp.length-1].end+1]);"FileTypeAppComment"==i[0]?(g.fileTypeAppComment=i[1],t()):e(2)}else e(1)}),new Promise(function(t,e){for(var n=[],i=function(o){n.push(new Promise(function(t,e){for(var n=o,i=new a,r=g.fileStruct.Eki[n].start;r<g.fileStruct.Eki[n].end;r++){var s=S.split(d[r]);switch(s[0]){case"Ekimei":i.name=s[1];break;case"Ekijikokukeisiki":i.timeType=a.timeTypeToInt(s[1]);break;case"Ekikibo":i.scale=a.scaleToInt(s[1]);break;case"Kyoukaisen":i.boundary=!0;break;case"DiagramRessyajouhouHyoujiKudari":i.trainInfoDown=a.trainInfoToInt(s[1]);break;case"DiagramRessyajouhouHyoujiNobori":i.trainInfoUp=a.trainInfoToInt(s[1])}}g.stations[n]=i,t()}))},r=0;r<g.fileStruct.Eki.length;r++)i(r);Promise.all(n).then(t)}),new Promise(function(t,e){for(var n=[],i=function(a){n.push(new Promise(function(t,e){for(var n=a,i=new l,r=g.fileStruct.Ressyasyubetsu[n].start;r<g.fileStruct.Ressyasyubetsu[n].end;r++){var s=S.split(d[r]);switch(s[0]){case"Syubetsumei":i.name=s[1];break;case"Ryakusyou":i.shortname=s[1];break;case"JikokuhyouMojiColor":var o=new h;o.setFromABGR(s[1]),i.trainColor=o;break;case"JikokuhyouMojiIndex":i.fontIdx=Number.parseInt(s[1]);break;case"DiagramSenColor":var u=new h;u.setFromABGR(s[1]),i.lineColor=u;break;case"DiagramSenStyle":i.lineType=l.lineStyleToInt(s[1]);break;case"DiagramSenIsBold":i.lineWeight=2;break;case"StopMarkDrawType":i.shoudDrawStopMark=!0}}g.trainTypes[n]=i,t()}))},r=0;r<g.fileStruct.Ressyasyubetsu.length;r++)i(r);Promise.all(n).then(t)}),new Promise(function(t,e){for(var n=[],i=function(o){n.push(new Promise(function(t,e){var k=o,m=new f;m.downStreaks=new Array(g.fileStruct.Dia[k].Kudari.length),m.upStreaks=new Array(g.fileStruct.Dia[k].Nobori.length);for(var n=[],i=function(_){n.push(new Promise(function(t,e){for(var n=_,i=new b,r=g.fileStruct.Dia[k].Kudari[n].start;r<g.fileStruct.Dia[k].Kudari[n].end;r++){var s=S.split(d[r]);switch(s[0]){case"Syubetsu":i.typeIdx=Number.parseInt(s[1]);break;case"RessyaBangou":i.operationNum=s[1];break;case"Ressyamei":i.name=s[1];break;case"Gousuu":i.no=s[1];break;case"EkiJikoku":for(var o=s[1].split(","),u=new Array(o.length),a=0;a<o.length;a++){var h=o[a],l=new w;if(""!==h){var f=h.split(";");if(l.type=Number.parseInt(f[0]),void 0!==f[1]){var c=f[1].split("/");void 0===c[1]?(l.arrival.isNull=!0,l.departure.isNull=!1,l.departure.setTime(c[0])):""===c[1]?(l.arrival.isNull=!1,l.arrival.setTime(c[0]),l.departure.isNull=!0):(l.departure.isNull=!1,l.departure.setTime(c[0]),l.arrival.isNull=!1,l.arrival.setTime(c[1]))}}u[a]=l}i.stHandlings=u;break;case"Bikou":i.comment=s[1]}}m.downStreaks[n]=i,t()}))},r=0;r<g.fileStruct.Dia[k].Kudari.length;r++)i(r);var s=function(p){n.push(new Promise(function(t,e){for(var n=p,i=new b,r=g.fileStruct.Dia[k].Nobori[n].start;r<g.fileStruct.Dia[k].Nobori[n].end;r++){var s=S.split(d[r]);switch(s[0]){case"Syubetsu":i.typeIdx=Number.parseInt(s[1]);break;case"RessyaBangou":i.operationNum=s[1];break;case"Ressyamei":i.name=s[1];break;case"Gousuu":i.no=s[1];break;case"EkiJikoku":for(var o=s[1].split(","),u=new Array(o.length),a=0;a<o.length;a++){var h=o[a],l=new w;if(""!==h){var f=h.split(";");l.type=Number.parseInt(f[0]);var c=new v,_=new v;if(void 0!==f[1]){var y=f[1].split("/");void 0===y[1]?(c.isNull=!0,_.setTime(y[0])):""===y[1]?(c.setTime(y[0]),_.isNull=!0):(_.setTime(y[0]),c.setTime(y[1]))}else c.isNull=!0,_.isNull=!0;l.arrival=c,l.departure=_}u[a]=l}i.stHandlings=u;break;case"Bikou":i.comment=s[1]}}m.upStreaks[n]=i,t()}))};for(r=0;r<g.fileStruct.Dia[k].Nobori.length;r++)s(r);g.diagrams[k]=m,t()}))},r=0;r<g.fileStruct.Dia.length;r++)i(r);Promise.all(n).then(t)})]).then(function(){}).catch(function(){return console.log("ERROR")})})}},{key:"fileStruct",get:function(){return this._fileStruct},set:function(t){this._fileStruct=t}},{key:"fileType",get:function(){return this._fileType},set:function(t){this._fileType=t}},{key:"fileTypeAppComment",get:function(){return this._fileTypeAppComment},set:function(t){this._fileTypeAppComment=t}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"stations",get:function(){return this._stations},set:function(t){this._stations=t}},{key:"trainTypes",get:function(){return this._trainTypes},set:function(t){this._trainTypes=t}},{key:"diagrams",get:function(){return this._diagrams},set:function(t){this._diagrams=t}}],[{key:"command",value:function(t){return t.split(/=/)[0]}},{key:"value",value:function(t){return t.split(/=/)[1]}},{key:"split",value:function(t){return[S.command(t),S.value(t)]}}]),S}();e.DataSet=u;var a=function(){function t(){r(this,t),this._name="",this._timeType=0,this._scale=0,this._trainInfoDown=0,this._trainInfoUp=0,this._boundary=!1,this._additionalOption=0,this._shouldShowLineNumberDown=!1,this._shouldShowLineNumberUp=!1,this._shouldShowLines=!1,this._lines=[],this._mainLineDown=0,this._mainLineUp=0}return o(t,[{key:"parseTimeType",value:function(){switch(this.timeType){case 10:return"Jikokukeisiki_Hatsuchaku";case 20:return"Jikokukeisiki_KudariChaku";case 30:return"Jikokukeisiki_NoboriChaku";default:return"Jikokukeisiki_Hatsu"}}},{key:"parseScale",value:function(){switch(this.scale){case 10:return"Ekikibo_Syuyou";default:return"Ekikibo_Ippan"}}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"timeType",get:function(){return this._timeType},set:function(t){this._timeType=t}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t}},{key:"trainInfoDown",get:function(){return this._trainInfoDown},set:function(t){this._trainInfoDown=t}},{key:"trainInfoUp",get:function(){return this._trainInfoUp},set:function(t){this._trainInfoUp=t}},{key:"boundary",get:function(){return this._boundary},set:function(t){this._boundary=t}},{key:"additionalOption",get:function(){return this._additionalOption},set:function(t){this._additionalOption=t}},{key:"shouldShowLineNumberDown",get:function(){return this._shouldShowLineNumberDown},set:function(t){this._shouldShowLineNumberDown=t}},{key:"shouldShowLineNumberUp",get:function(){return this._shouldShowLineNumberUp},set:function(t){this._shouldShowLineNumberUp=t}},{key:"shouldShowLines",get:function(){return this._shouldShowLines},set:function(t){this._shouldShowLines=t}},{key:"lines",get:function(){return this._lines},set:function(t){this._lines=t}},{key:"mainLineDown",get:function(){return this._mainLineDown},set:function(t){this._mainLineDown=t}},{key:"mainLineUp",get:function(){return this._mainLineUp},set:function(t){this._mainLineUp=t}}],[{key:"timeTypeToInt",value:function(t){switch(t){case"Jikokukeisiki_Hatsuchaku":return 10;case"Jikokukeisiki_KudariChaku":return 20;case"Jikokukeisiki_NoboriChaku":return 30;default:return 0}}},{key:"scaleToInt",value:function(t){switch(t){case"Ekikibo_Syuyou":return 10;default:return 0}}},{key:"trainInfoToInt",value:function(t){switch(t){case"DiagramRessyajouhouHyouji_Anytime":return 20;case"DiagramRessyajouhouHyouji_Not":return 0;default:return 10}}}]),t}();e.Station=a;var l=function(){function t(){r(this,t),this._name="",this._shortname="",this._trainColor=new h,this._fontIdx=0,this._lineColor=new h,this._lineType=0,this._lineWeight=0,this._shoudDrawStopMark=!1}return o(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"shortname",get:function(){return this._shortname},set:function(t){this._shortname=t}},{key:"trainColor",get:function(){return this._trainColor},set:function(t){this._trainColor=t}},{key:"fontIdx",get:function(){return this._fontIdx},set:function(t){this._fontIdx=t}},{key:"lineColor",get:function(){return this._lineColor},set:function(t){this._lineColor=t}},{key:"lineType",get:function(){return this._lineType},set:function(t){this._lineType=t}},{key:"lineWeight",get:function(){return this._lineWeight},set:function(t){this._lineWeight=t}},{key:"shoudDrawStopMark",get:function(){return this._shoudDrawStopMark},set:function(t){this._shoudDrawStopMark=t}}]),o(t,null,[{key:"lineStyleToInt",value:function(t){switch(t){case"SenStyle_Tensen":return 10;case"SenStyle_Hasen":return 20;default:return 0}}}]),t}();e.TrainType=l;var f=function(){function t(){r(this,t),this._name="",this._downStreaks=new Array,this._upStreaks=new Array}return o(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"downStreaks",get:function(){return this._downStreaks},set:function(t){this._downStreaks=t}},{key:"upStreaks",get:function(){return this._upStreaks},set:function(t){this._upStreaks=t}}]),t}();e.Diagram=f;var b=function(){function t(){r(this,t),this._operationNum="",this._typeIdx=0,this._name="",this._destIdx=0,this._stHandlings=new Array,this._comment=""}return o(t,[{key:"operationNum",get:function(){return this._operationNum},set:function(t){this._operationNum=t}},{key:"typeIdx",get:function(){return this._typeIdx},set:function(t){this._typeIdx=t}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"no",get:function(){return this._no},set:function(t){this._no=t}},{key:"destIdx",get:function(){return this._destIdx},set:function(t){this._destIdx=t}},{key:"stHandlings",get:function(){return this._stHandlings},set:function(t){this._stHandlings=t}},{key:"comment",get:function(){return this._comment},set:function(t){this._comment=t}}]),t}();e.Streak=b;var w=function(){function t(){r(this,t),this._type=0,this._arrival=new v,this._departure=new v,this._track=0,this._endpointWork=e.EndpointWork,this.type=0,this.arrival=new v,this.departure=new v}return o(t,[{key:"type",get:function(){return this._type},set:function(t){this._type=t}},{key:"arrival",get:function(){return this._arrival},set:function(t){this._arrival=t}},{key:"departure",get:function(){return this._departure},set:function(t){this._departure=t}},{key:"track",get:function(){return this._track},set:function(t){this._track=t}},{key:"endpointWork",get:function(){return this._endpointWork},set:function(t){this._endpointWork=t}}]),t}();e.StHandling=w}],r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)).default;function r(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}var n,i});